<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <title>마이페이지</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/annual.css}" rel="stylesheet">
    <link th:href="@{/css/signin.css}" rel="stylesheet">
    <link th:href="@{/css/jquery.datetimepicker.css}" rel="stylesheet">
    <script th:src="@{js/jquery-3.2.1.js}"></script>
    <script th:src="@{js/jquery.datetimepicker.full.min.js}"></script>
</head>
<body>
    <div class="container">
        <header class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">
            <div class="col-md-12 text-end">
                <div class="inline-block images float">
                    <a th:href="@{/}">
                        <img src="/images/hncis.png">
                    </a>
                </div>
                <div th:if="${user.auth.equals('admin')}" class="inline-block float m-lg-3">
                    <a th:href="@{/selectAll}"> 전체 조회</a>
                </div>
                <div th:if="${user.auth.equals('admin')}" class="inline-block float m-lg-3">
                    <a th:href="@{/memberManagement}"> 회원 관리</a>
                </div>
                <form th:action="@{/mypage}" method="get" class="inline-block">
                    <span class="mb-3" th:text="|${user.user_name} ${user.responsibilities_of_office}   |">로그인 사용자 이름</span>
                    <button type="submit" class="btn btn-outline-primary me-2 mypage">마이페이지</button>
                </form>
                <form th:action="@{/logout}" method="post" class="inline-block">
                    <button type="submit" class="btn btn-dark logout">로그아웃</button>
                </form>
            </div>
        </header>
        <section>
            <table class="table">
                <thread>
                    <tr class="pb-3 pt-3">
                        <th scope="col" class="pb-4 pt-4 text-center text-bold">#</th>
                        <th scope="col" class="pb-4 pt-4 text-center text-bold">아이디</th>
                        <th scope="col" class="pb-4 pt-4 text-center text-bold">이름</th>
                        <th scope="col" class="pb-4 pt-4 text-center text-bold">사용연차</th>
                        <th scope="col" class="pb-4 pt-4 text-center text-bold">날짜</th>
                        <th scope="col" class="pb-4 pt-4 text-center text-bold">승인여부</th>
                        <th scope="col" class="pb-4 pt-4 text-center text-bold">취소</th>
                    </tr>
                </thread>
                <tbody>
                    <tr th:each="list, index : ${history}">
                        <th scope="row" class="pb-4 pt-4 text-center table-custom">[[${index.count}]]</th>
                        <td scope="row" class="pb-4 pt-4 text-center table-custom">[[${list.user_id}]]</td>
                        <td scope="row" class="pb-4 pt-4 text-center table-custom">[[${list.user_name}]]</td>
                        <td scope="row" class="pb-4 pt-4 text-center table-custom">[[${list.application_year}]]일 / [[${list.time}]]</td>
                        <td scope="row" class="pb-4 pt-4 text-center table-custom">[[${list.start_date}]] ~ [[${list.end_date}]]</td>
                        <td scope="row" class="pb-4 pt-4 text-center table-custom">[[${list.appr_yn}]]</td>
                        <td scope="row" class="pb-4 pt-4 text-center table-custom" th:if="${list.appr_yn.equals('N')}"><a href="javascript:void(0)" style="color: red;" th:name="${list.history_id}" th:onclick="deleteHistory(this)">취소</a></td>
                        <td scope="row" class="pb-4 pt-4 text-center table-custom" th:if="${list.appr_yn.equals('Y')}"></td>
                    </tr>
                </tbody>
            </table>
        </section>
    </div>
<script>
    function deleteHistory(id){
        fetch("/deleteHistory/"+id.name, {
            method: "DELETE",
            headers: {
                'Content-Type': 'application/json'
            },
            body: {
            }
        }).then((response) => {
            if(!response.ok)
                throw response;
            alert("삭제가 완료되었습니다.");
            window.location.href="/mypage";
        }).catch(e => {
            console.log("에러 발생");
        });
    }

</script>
</body>
</html>